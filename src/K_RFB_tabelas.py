from pathlib import Path
import bs4 as bs
import os
import pandas as pd
import re
import time
import zipfile
import urllib.request

from time import sleep
from tqdm import tqdm
from B_Def_Global import limpar_terminal, GetEnv, download_arquiv_barprogress, print_divisor_inicio_fim, split_csv_file_pandas_todos, print_parcial_final_log_inf_retorno, log_retorno_info, log_retorno_erro, conecta_bd_generico, funçao_barprogress, leitura_csv_insercao_bd_sql, criar_chaves_primaria_tabelas, criar_chaves_estrangeiras_tabelas, verificar_repetidos_tabelas, remover_repetidos_tabelas, verificar_dados_faltantes_tabelas, inserir_dados_faltantes_tabelas
from Z_Logger import Logs
logs = Logs(filename="logs.log")


def sql_tb_rfb_estabele_porte():
    """Função para criação da tabela estabelecimentos ativos no banco de dados postgres
    """
    try:

        insert_start = time.time()
        extracted_files = GetEnv('EXTRACTED_FILES_PATH_CONVERT')
        base_dados = GetEnv('DB_NAME')

        # Dados arquivo/tabela (ESTABELECIMENTOS)
        # Criar tabela
        sql = '''
            CREATE TABLE IF NOT EXISTS "tb_rfb_estabelecimento_porte" (
                "id_cd_porte" integer NOT NULL,
                "st_porte_descricao" text,
                CONSTRAINT "pk_tb_rfb_estabelecimento_porte" PRIMARY KEY (id_cd_porte)
            )
            '''

        # Inserir csv para o banco de dados
        leitura_csv_insercao_bd_sql('tb_rfb_estabelecimento_porte',
                                    'tb_rfb_estabelecimento_porte',
                                    sql,
                                    'ibge',
                                    extracted_files)

        # Crias chaves Estrangeiras nas tabela tb_rfb_empresas para tabela tb_rfb_estabelecimento_porte
        tabela_temp = 'tb_rfb_empresas'
        tabela_temp_origem = 'tb_rfb_estabelecimento_porte'
        nome_fk_coluna = 'FK_id_cd_porte'
        coluna_temp1 = 'cod_porte_empresa'
        coluna_temp1_origem = 'id_cd_porte'

        criar_chaves_estrangeiras_tabelas(base_dados,
                                          tabela_temp,
                                          tabela_temp_origem,
                                          nome_fk_coluna,
                                          coluna_temp1,
                                          coluna_temp1_origem)
        insert_end = time.time()

        print_parcial_final_log_inf_retorno(f'criação da tabela {tabela_temp_origem} de chaves estrangeiras na tabela {tabela_temp} na {base_dados}',
                                            insert_start,
                                            insert_end,
                                            '',
                                            'geral')

    except Exception as text:

        log_retorno_erro(text)


def sql_tb_rais_estabele_tamanho():
    """Função para criação da tabela estabelecimentos ativos no banco de dados postgres
    """

    try:

        insert_start = time.time()
        extracted_files = GetEnv('EXTRACTED_FILES_PATH_CONVERT')
        base_dados = GetEnv('DB_NAME')

        # Dados arquivo/tabela (ESTABELECIMENTOS)
        # Criar tabela
        sql = '''
            CREATE TABLE IF NOT EXISTS tb_rais_estabelecimento_tamanho
            (
                id_cd_tamanho_estabelecimento smallint NOT NULL,
                st_descricao_tamanho text,
                CONSTRAINT pk_tb_rais_estabelecimento_tamanho PRIMARY KEY (id_cd_tamanho_estabelecimento)
            )
            '''
        # fk_tb_rais_estabelecimentos.tamanho_estabelecimento

        # Inserir csv para o banco de dados
        leitura_csv_insercao_bd_sql('tb_rais_estabelecimento_tamanho',
                                    'tb_rais_estabelecimento_tamanho',
                                    sql,
                                    'ibge',
                                    extracted_files)

        # Crias chaves Estrangeiras nas tabela tb_rfb_empresas para tabela tb_rfb_estabelecimento_porte
        tabela_temp = 'tb_rais_estabelecimentos'
        tabela_temp_origem = 'tb_rais_estabelecimento_tamanho'
        nome_fk_coluna = 'FK_id_cd_tamanho_estabelecimento'
        coluna_temp1 = 'tamanho_estabelecimento'
        coluna_temp1_origem = 'id_cd_tamanho_estabelecimento'

        criar_chaves_estrangeiras_tabelas(base_dados,
                                          tabela_temp,
                                          tabela_temp_origem,
                                          nome_fk_coluna,
                                          coluna_temp1,
                                          coluna_temp1_origem)

        insert_end = time.time()

        print_parcial_final_log_inf_retorno(f'criação da tabela {tabela_temp_origem} de chaves estrangeiras na tabela {tabela_temp} na {base_dados}',
                                            insert_start,
                                            insert_end,
                                            '',
                                            'geral')

    except Exception as text:

        log_retorno_erro(text)


def tb_sql_estabele_ativos():
    """Função para criação da tabela estabelecimentos ativos no banco de dados postgres
    """

    try:

        # Conectar:
        cur, pg_conn = conecta_bd_generico(GetEnv('DB_NAME'))

        insert_start = time.time()
        extracted_files = GetEnv('EXTRACTED_FILES_PATH_CONVERT')
        base_dados = GetEnv('DB_NAME')

        # Dados arquivo/tabela (ESTABELECIMENTOS)
        # Criar tabela

        sql = '''
            CREATE TABLE tb_rfb_estabelecimento_reduzido_ativos AS
            SELECT
            tb_rfb_estabelecimentos.id_cod_cnpj_completo_num AS "CNPJ RFB",
            REGEXP_REPLACE (tb_rfb_estabelecimentos.id_cod_cnpj_completo_txt, '([0-9]{2})([0-9]{3})([0-9]{3})([0-9]{4})','\1.\2.\3/\4-') AS "CNPJ RFB TEXTO",
            tb_rfb_estabelecimentos.cod_identificador_matriz_filial AS "MATRIZ OU FILLIAL",
            tb_rfb_estabelecimentos.nome_fantasia AS "NOME FANTASIA",
            tb_rfb_empresas.razao_social AS "RAZAO SOCIA",
            tb_rfb_estabelecimentos.data_inicio_atividade AS "DATA INICIO",
            tb_rfb_simples.opcao_pelo_simples AS "OPCAO SIMPLES",
            tb_rfb_simples.opcao_mei AS "OPCAO MEI",
            tb_rfb_estabelecimento_porte.st_porte_descricao AS "PORTE RFB",
            tb_rais_estabelecimento_tamanho.st_descricao_tamanho AS "PORTE RAIS",
            tb_rais_estabelecimentos.qtd_vinculos_estatutarios AS "QTD VINCULOS RAIS",
            tb_rfb_estabelecimentos.cod_cnae_fiscal_principal AS "COD CNAE PRINCIPAL",
            tb_ibge_municipios.id_cod_municipio_ibge AS "COD MUNICIPIO COMPLETO",
            tb_rfb_pais.nome_pais ||', '||
            tb_rfb_estabelecimentos.uf ||' - '||
            tb_ibge_municipios.nome_municipio_ibge  ||', '||
            REGEXP_REPLACE (tb_rfb_estabelecimentos.cep, '([0-9]{5})([0-9]{3})','\1-\2') ||', '||
            tb_rfb_estabelecimentos.bairro ||', '||
            tb_rfb_estabelecimentos.tipo_logradouro  ||' '||
            tb_rfb_estabelecimentos.logradouro  ||' '||
            tb_rfb_estabelecimentos.numero  AS "ENDEREÇO",
            tb_rfb_estabelecimentos.ddd_1 AS "DDD1",
            tb_rfb_estabelecimentos.telefone_1 AS "FONE1",
            tb_rfb_estabelecimentos.ddd_2 AS "DDD2",
            tb_rfb_estabelecimentos.telefone_2 AS "FONE2",
            tb_rfb_estabelecimentos.correio_eletronico AS "EMAIL",
            tb_rfb_estabelecimentos.cod_situacao_cadastral AS "COD SITUAÇÃO CAD"
            FROM tb_rfb_estabelecimentos
            LEFT JOIN tb_rfb_municipios ON tb_rfb_estabelecimentos.id_cod_municipio_tom = tb_rfb_municipios.id_cod_municipio_tom_rfb
            LEFT JOIN tb_ibge_municipios ON tb_rfb_municipios.id_cod_municipio_tom_rfb = tb_ibge_municipios.id_cod_municipio_tom_rfb
            LEFT JOIN tb_rfb_empresas ON tb_rfb_estabelecimentos.id_cod_cnpj_basico = tb_rfb_empresas.id_cod_cnpj_basico
            LEFT JOIN tb_rfb_simples ON tb_rfb_empresas.id_cod_cnpj_basico = tb_rfb_simples.id_cod_cnpj_basico
            LEFT JOIN tb_rais_estabelecimentos ON tb_rfb_estabelecimentos.id_cod_cnpj_completo_num = tb_rais_estabelecimentos.id_cnpj_cei
            LEFT JOIN tb_rais_estabelecimento_tamanho ON tb_rais_estabelecimentos.tamanho_estabelecimento = tb_rais_estabelecimento_tamanho.id_cd_tamanho_estabelecimento
            LEFT JOIN tb_rfb_estabelecimento_porte ON tb_rfb_empresas.cod_porte_empresa = tb_rfb_estabelecimento_porte.id_cd_porte
            LEFT JOIN tb_rfb_pais ON tb_rfb_estabelecimentos.cod_pais = tb_rfb_pais.id_cod_pais
            WHERE tb_rfb_estabelecimentos.cod_cnae_fiscal_principal NOT IN (87654547000199, 1650178000140, 8372222000147, 11160552000183, 12026980000180, 13624323000106, 31587659000110, 7323544000133, 10823533000127, 9386256000153, 10801453000170, 4784470000144, 91852087000180, 5290116000126, 92572668000121, 14244879000121, 31608589000139, 13152818000171, 12361704000179, 4834318000129, 17681193000196, 142402000120, 7033854000113, 1287024000136, 19192998000100, 26167903000155, 80738016000135, 18330394000101, 13393720000106, 10607264000161, 13348127000148, 5168429000106, 12755072000128, 12085614000100, 10954040000126, 17870582000160, 32022417000141, 17624843000161, 19858793000102, 26589865000129, 7092635000105, 6876768000100, 30745263000190, 2291846000153, 10724474000130, 18327497000112, 10324550000110, 11750929000154, 10417278000112, 37149378000161, 4606368000159, 90244328000146, 11011017000160, 91292987000110, 8764222000192, 14241179000183, 21521837000156, 5749407000130, 11319557000106, 5280807000149, 15773448000115, 5778763000181, 23733204000137, 6745734000186, 6279025000152, 87239448000140, 24722176000115, 77595395000147, 3387396000160, 23896394000103, 6112100000196, 41221516000143, 33031980000149, 9292819000144, 18648655000136, 18959545000195, 20290950000105, 14263090000118, 12868609000166, 10926916000120, 2405739000109, 30766484000145, 15987122000190, 1457287000146, 10965700000174, 5528196000105, 8075353000162, 77860435000130, 3258582000107, 1191673000139, 13766440000104, 25433214000182, 11739120000121, 57508426000178, 23096767000161, 1646378000120, 91182626000111, 29607095000198, 13676569000113, 1400923000101, 77603892000140, 35793784000137, 93403111000120, 8169258000128, 10556240000120, 5853843000154, 224288000188, 25086388000116, 72269012000127, 1682695000100, 28050012000140, 20239304000113, 78522554000146, 13163187000196, 20928455000189, 10264676000146, 26545701000108, 12067448000101, 2814497000107, 9134425000168, 11372084000100, 97211676000166, 12569628000191, 29708632000196, 4392005000168, 38311937000150, 11855966000127, 80478555000182, 27797063000177, 5928773000156, 10331291000154, 10319273000157, 14142262000103, 91138586000100, 97462816000179, 78724937000105, 25187828000121, 9196947000194, 1017449000125, 33081779000176, 21450633000171, 9090259000145, 13996470000107, 29881685000104, 2853780000148, 6209436000171, 9004287000100, 76989177000124, 63864771000147, 91864868000195, 22892910000169, 5032192000131, 26053424000108, 2579293000139, 7830558000143, 19334622000184, 10557159000165, 1674325000112, 12647362000158, 21399675000125, 9344389000167, 26086346000148, 9062965000183, 1185571000100, 4184646000127, 13704959000150, 18651461000190, 11121536000181, 6942101000168, 13240780000199, 9524449000123, 16920620000189, 8033521000157, 7870988000199, 86365350000177, 83011460000142, 18923585000187, 30411573000179, 7200203000170, 73856593000166, 14438471000190, 4590361000196, 3033301000100, 5067427000120, 32693095000162, 4955487000117, 3931194000137, 24544921000183, 7436513000199, 4415928000198, 2089969000106, 8311247000130, 3507744000195, 51023505000102, 13314645000140, 7606856000154, 10473269000149, 18856650000107, 4117484000104, 29404579000130, 4035721000198, 6077541000102, 2183774000120, 14856981000188, 9420215000136, 7580415000120, 2494891000105, 4439268000185, 9061689000139, 32402812000150, 79884201000159, 15984883000199, 90810706000101, 93090009000111, 17286461000175, 42985218000192, 25298910000123, 2030706000121, 6317393000148, 13584067000162, 24774433000162, 7443925000156, 13338682000199, 32864563000114, 4846902000102, 11152224000135, 7062098000150, 10518576000107, 81097503000129, 70097530000185, 7891015000136, 8375450000170, 11746084000123, 2399039000159, 6099712000196, 5672509000102, 11501334000165, 92730902000100, 30593462000120, 17778636000161, 12468400000105, 27723961000180, 73301814000130, 10655578000130, 18861682000192, 10653748000147, 4082624000156, 24250559000138, 20084744000149, 77845204000158, 94158912000130, 9262036000118, 717643000150, 10856350000108, 2501446000125, 89605505000193, 28215194000161, 13577156000181, 7938803000130, 83633552000164, 61916854000107, 17725726000194, 86577053000195, 36221828000117, 4521258000194, 14748505000143, 13569064000150, 4373539000147, 15862954000180, 13152186000146, 3737189000198, 20780212000146, 2876925000126, 32177092000176, 85778074000106, 16705150000130, 11137652000199, 32750620000134, 25245387000177, 12572403000194, 8335717000104, 19336810000141, 4775220000148, 2110010000105, 88094701000188, 60620366000195, 8776690000187, 91552687000123, 20353535000153, 3599608000172, 28664836000100, 6319500000177, 94672557000112, 75862961000104, 6021077000124, 23893289000110, 7301609000140, 65133423000125, 17454167000125, 73747164000150, 67331991000166, 30754413000122, 442060000164, 9070256000140, 2038025000100, 4075353000101, 21811317000188, 32876004000124, 37824745000185, 71507149000100, 9677256000102, 32237784000162, 1009078000130, 40756983000105, 5630747000147, 19178398000189, 22229447000170, 86421807000202, 4653148000186, 33931722000119, 7863671000125, 10319110000174, 7375625000187, 49914674000190, 7838419000166, 11460795000137, 82151382000119, 13197691000107, 21005582000179, 18688674000196, 7661744000104, 13002242000166, 33518975000165, 34742643000122, 14034002000106, 68917939000159, 5735623000126, 1496674000191, 43872274000183, 13104559000880, 5538848000192, 33817696000100, 10142144000136, 484213000136, 4758104000110, 80967193000193, 30774598000137, 641509000113, 11702090000189, 10293584000194, 952888000162, 9013998000133, 3912940000145, 7787570000112, 33771981000120, 793334000160, 23660930000177, 22873748000131, 20264474000158, 7661025000185, 10906818000121, 4961098000102, 4798150000143, 11918451000129, 34047293000184, 5194398000168, 27320369000138, 26136541000135, 24156274000132, 9639440000168, 1557107000106, 23334908000137, 31865753000193, 804102000160, 12937918000140, 15057636000147, 1759870000101, 354138000199, 11114322000188, 9305229000109, 21962126000117, 26404731000196, 73219024000100, 14958619000118, 2400983000189, 11098320000142, 5853586000150, 54514294000107, 34565836000155, 17475120000148, 8844658000191, 4655002000170, 36807782000112, 22882054000160, 3304122000160, 93255560000178, 21261633000123, 84558246000173, 10510260000160, 5540826000167, 14053405000100, 4083740000190, 3064064000144, 7632090000182, 12772041000185, 90522616000115, 24593984000120, 4169552000189, 27582444000139, 7249792000181, 14906006000137, 3344114000147, 2838996000134, 9544299000110, 14988166000172, 8596031000169, 6860056000100, 49150352001780, 11015268000113, 3241729000148, 3949277000153, 7124537000102, 3052955000180, 27053643000150, 3815704000100, 4032698000188, 1718007000106, 1518918000190, 40881070000110, 31776980000142, 4779723000191, 22709109000488, 10429912000137, 5800922000105, 74766452000115, 7415457000106, 26308783000169, 17582811000140, 1518792000153, 3580670000112, 11572365000107, 7293074000102, 10488640000146, 9603433000106, 2137011000143, 85779049000147, 20501045000157, 15352689000190, 11058004000147, 8316250000147, 19221529000163, 6894902000103, 10201332000198, 4242295000163, 3485572000104, 4183037000153, 72671985000198, 24580379000114, 846087000112, 8818635000102, 25113317000165, 12988833000191, 20637022000174, 35416995000150, 3060101000146, 28035917000140, 28608910000170, 9044133000134, 2028121000177, 4295678000108, 18555317000150, 26349902000121, 2320214000170, 4013782000154, 2693879000120, 19391098000183, 10417944000112, 3315118000105, 3123142000134, 10955404000192, 90609108000179, 7739675000104, 24436602000154, 35223590000104, 9306435000133, 4305323000144, 73112021000172, 2731568000108, 773500000166, 70357959000164, 2314123000122, 33904216000130, 7041711000153, 13616671000123, 19376115000103, 5262669000175, 88766639000123, 4853451000122, 14379618000119, 9326382000112, 89908727000185, 1134900000194, 23957787000180, 28109100000170, 16492097000137, 5662237000151, 13479150000171, 29801202000114, 8149575000182, 24744354000109, 9622693000129, 8939220000197, 12266152000110, 82284894000153, 12181806000102, 2578849000172, 27717999000140, 7335692000178, 15251430000153, 19762269000133, 87843033000181, 6276610000107, 13428316000120, 25804147000165, 5935542000170, 92314079000143, 11186727000121, 5291198000123, 18334203000180, 35093301000191, 22221083000181, 75216523000179, 7459218000158, 36394573000194, 39815253000159, 9424036000177, 8388070000170, 84718741000100, 26069514000197, 19867464000128, 85285963000131, 30967492000150, 17741764000130, 28578840000155, 90740754000170, 35725815000112, 11404442000110, 29558488000159, 25376211000154, 12998267000107, 8687308000169, 3601579000136, 26953545000106, 31588721000198, 27127366000182, 20781169000133, 83567131000182, 6255024000178, 8806091000169, 12367204000144, 52476850000164, 8990717000130, 15629579000123, 13612189000115, 24772424000132, 196198000120, 7144671000175, 31341267000176, 37413861000101, 7682079000127, 85494680000108, 9171688000147, 83535252000142, 37813005000143, 73909566000104, 16863858000110, 1253958000157, 75267096000158, 31367633000166, 2297711000103, 80896806000149, 3650831000105, 83814814000197, 25994179000170, 10629153000156, 7684186000194, 12726300000131, 94123924000129, 2686151000170, 1742668000177, 9641131000122, 1488023000150, 25056200000197, 9174668000120, 21719299000109, 236671000156, 1703234000168, 7073022000120, 4535308000192, 4371905000129, 2014786000121, 21521925000158, 4749121000191, 84640580000171, 234266000107, 31874640000154, 18157929000194, 9050399000190, 1389000190, 18400766000129, 16625131000102, 87568200000123, 5763785000178, 11021978000156, 5316470000182, 4940257000184, 9068809000120, 91358788000168, 19051962000106, 3224567000130, 2472170000102, 9497934000155, 82096413000186, 10546807000188, 97094213000161, 31685489000106, 6862627000138, 361145000118, 5680854000180, 71320915000122, 7305810000103, 4751143000196, 2899356000134, 3156454000144, 79671236000100, 7978664000179, 26629673000107, 5584693000120, 93915817000170, 22820121000112, 10394709000172, 25964297000136, 28206623000134, 17284472000116, 6031432000146, 20647083000112, 22720429000196, 32296378000170, 20487400000180, 2440124000202, 33873562000107, 8527137000100, 26469075000100, 20929806000176, 14586770000172, 20319862000199, 6944437000160, 4699734000161, 7278138000104, 9346890000162, 4742371000108, 21130401000136, 27665301000190, 4986601000176, 14339371000107, 820570000128, 23320828000122, 26324835000190, 18017986000178, 23446628000110, 93037000101, 5842683000148, 8995091000154, 8046521000191, 9029474000130, 35315298000103, 86764511000103, 10873405000198, 7435640000173, 23792228000167, 80755135000104, 72026024000120, 17907975000109, 27422098000121, 14986335000135, 22605881000107, 75864728000160, 5169277000166, 8328971000177, 9626955000123, 9583268000178, 50461862000190, 10156597000111, 24272120000106, 4007969000145, 108947000110, 2272397000104, 11228680000111, 6942954000108, 10334488000147, 17337357000162, 1089636000114, 3128888000130, 10353532000166, 947030000100, 15993215000128, 5194005000116, 17178947000190, 12359092000180, 33130762000161, 2492310000104, 5466497000151, 8246247000102, 16857013000111, 15866494000169, 22277750000148, 7005073000115, 3995725000155, 16948086000119, 9142445000180, 19851584000137, 9245965000119, 24138177000117, 27074467000132, 23197841000136, 15393287000134, 14790204000188, 77371789000111, 20841144000188, 11804459000164, 25179227000177, 7428727000113, 17569551000173, 12991318000160, 7705871000150, 9296387000140, 86697794000100, 18717889000198, 5505984000186, 82024548000136, 2612937000143, 10315503000100, 11734333000160, 33310392000144, 5753695000104, 31666870000128, 5505281000158, 10342077000101, 59225268000174, 20258849000177, 9083970000172, 7105803000150, 2689608000109, 569638000148, 1667041000107, 8031846000109, 11234956000174, 30444064000142, 14247873000108, 81866592000120, 7621282000193, 11001080000116, 3659621000170, 18552925000100, 36127970000108, 32986909000157, 93899359000123, 80213705000126, 19046218000105, 30081600000192, 89943849000102, 23615570000191, 1766275000101, 30755223000120, 75130245000132, 37929615000107, 94675295000140, 93445963000180, 90295338000100, 33689469000139, 13891071000173, 7248875000156, 3531879000196, 7322489000167, 89305197000180, 22456927000173, 8354288000104, 4141900000100, 22280670000141, 9110878000154, 12133320000107, 22354902000169, 55643555000143, 27153586000180, 12001402000190, 13249713000135, 20005140000160, 2276470000108, 4910063000136, 67673087000139, 19540628000108, 23176936000173, 22251565000184, 1211210000191, 17191016000121, 2284641000140, 41697285000149, 94931912000120, 3958603000199, 5467743000190, 8072308000154, 6916962000171, 7576815000162, 8282001000188, 32981557000147, 11045451000161, 2322372000160, 4190025000156, 8166114000118, 7537580000108, 8457522000129, 13054076000141, 2851400000136, 5862382000186, 37657084000140, 13269933000120, 12506396000122, 28254772000179, 37527173000172, 4770484000109, 1771322000105, 11783783000143, 33326931000133, 97225346000120, 11363988000170, 74631011000106, 19827805000131, 3735190000183, 286675000149, 28430762000147, 11450748000102, 6628333000146, 52985272000191, 7001950000180, 5902762000105, 26383059000108, 10593247000112, 95600235000120, 29467341000153, 25158815000124, 49475833000106, 5797607000168, 1733416000181, 3877185000105, 91704882000121, 10226694000133, 8395782000389, 8742386000119, 969518000138, 20321038000173, 70160569000108, 51609238000150, 18107045000125, 3540368000130, 90954892000152, 25071206000214, 6182834000141, 10377432000170, 13414093000142, 11582787000163, 6348590000124, 62098587000170, 2595626000113, 19445733000168, 2591772000170, 84552827000106, 23339549000100, 10857495000123, 32234596000180, 12876296000198, 7030782000150, 9286416000192, 11485623000118, 5215132000154, 22354870000100, 11101919000198, 8538303000174, 85179687000127, 29938282000154, 15570971000144, 4234108000108, 32770509000100, 23119027000101, 32118250000117, 79731642000110, 26608359000130, 82784216000150, 35280632000130, 4711205000136, 6890010000126, 7789728000193, 7931395000195, 28569816000150, 13089515000151, 7629404000198, 2736688000106, 24462610000175, 4498933000101, 10905062000104, 31882359000163, 11504209000109, 81035388000168, 21946485000180, 30563332000145, 16515058000108, 4535267000134, 8972622000193, 623492000171, 31187412000106, 3392558000158, 2264742000150, 85075141000126, 34943991000168, 97385876000135, 2267742000103, 21265282000129, 14514225000170, 10864443000184, 7416694000191, 8246978000140, 15116538000133, 2019387000153, 9517479000102, 4427124000109, 77817674000108, 25275663000140, 18458237000186, 5654524000110, 7930496000141, 8090078000156, 7224562000168, 15370406000133, 11575452000118, 33281991000187, 10367327000150, 21894569000118, 17384587000182, 33078767000192, 3080418000144, 89631998000136, 14713212000120, 14207493000140, 35411767000198, 8474088000195, 11983847000150, 7649230000125, 4697865000100, 82120460000118, 10439285000115, 71235295000123, 2866734000183, 41687484000257, 78742384000105, 5790491000135, 3410797000193, 8296762000199, 7409655000167, 27419009000198, 56761570000159, 12940209000114, 4477018000130, 2407579000137, 16026841000108, 84600378000116, 2924249000119, 1164075000170, 62098587000413, 34969576000183, 10856709000147, 42237412000190, 12726493000120, 5939266000118, 11477713000167, 958548000149, 7028514000102, 12826187000166, 20469578000107, 11143950000191, 27806368000106, 13240799000135, 30080460000138, 5437370000104, 28111682000129, 13961509000142, 10349258000151, 1682147000171, 10770797000160, 11316220000145, 19668909000140, 22020994000140, 911696000108, 34195547000101, 24977964000152, 10364691000166, 28580702000100, 16111833000160, 76865377000175, 11105698000126, 15823601000171, 130790000120, 65963142000108, 29567699000158, 8299152000149, 10905163000177, 11944052000132, 30719860000140, 6353241000109, 12354843000175, 3927995000129, 35284991000166, 20294734000138, 7010513000122, 3717227000140, 19297637000110, 616839000159, 80812092000143, 15583552000147, 7228698000146, 29353919000140, 26547362000190, 8533503000134, 32613134000174, 4234637000101, 12721248000120, 13271091000141, 30725265000118, 4228626000100, 72067523000166, 29607886000118, 66432501000155, 8696758000118, 17200017000195, 8038502000113, 4612254000111, 9174668000200, 30222814000131, 94938750000152, 16502667000122, 62404264000168, 11739586000127, 24883359000112, 14072177000108, 5134355000197, 4441266000120, 13057809000100, 11160749000112, 9361956000193, 41448556000122, 92215763000178, 11949701000198, 17194994000127, 5624386000126, 704968000107, 28862709000115, 13481491000181, 23736320000100, 8174282000155, 10815830000120, 2436957000100, 349823000127, 2297980000161, 9482747000106, 4828338000197, 6132707000138, 35496123000140, 37791609000136, 16801508000129, 7984506000121, 1106257000195, 33722608000189, 91749366000113, 22579338000182, 7346923000149, 9220797000107, 72370364000174, 30120557000127, 9544291000153, 8802842000179, 9686521000119, 46680708000131, 636743000152, 32679738000113, 7445385000140, 17179801000169, 62461140000114, 4220766000132, 3902129000183, 10870662000176, 19570720000110, 7866845000103, 7150233000110, 8427008000140, 7342052000195, 1302294000179, 50154061000181, 30941898000163, 11009721000189, 18824765000101, 5959479000101, 20483788000141, 11623188000140, 69418101000183, 98513187000121, 14056371000108, 8469844000198, 28321736000180, 20405316000170, 7059955000163, 24206617000126, 15489834000180, 5108821000160, 17420521000109, 4056752000125, 16626814000176, 4442991000113, 1149282000156, 10947853000199, 32972408000111, 7667939000153, 23422758000113, 6010434000159, 5452972000130, 10193089000103, 19169675000197, 94560620000129, 2234943000104, 1196411000167, 34946519000189, 911664000102, 20507442000136, 2654132000162, 3768328000140, 38154506000128, 17431120000146, 34903896000130, 97168066000127, 43015734000157, 13042032000100, 8901198000196, 19420416000197, 15287467000131, 71131296000128, 7307836000182, 7350344000170, 3946428000110, 21823191000161, 44938694000188, 3832894000174, 27966400000102, 4018242000163, 7883178000177, 2156401000160, 37323959000178, 9483354000109, 43248863000195, 43667922000160 
            ) AND cod_situacao_cadastral IN (2) 
            AND
            tb_rfb_estabelecimentos.cod_cnae_fiscal_principal IN (2121101, 2121102, 2121103, 2122000, 3211602, 4741500, 4771701, 4771702, 4783101, 5120000, 5611201, 9601701, 1091101, 4711301, 4711302, 4712100, 4721102, 4721103, 4721104, 4722901, 4722902, 4724500, 4771704, 4789004, 7500100, 9609207, 9609208, 4621400, 4623101, 4623102, 4623103, 4623104, 4623105, 4623106, 4623107, 4623108, 4623109, 4632001, 4632002, 4632003, 4633801, 4633802, 4633803, 4634601, 4634602, 4634603, 4635401, 4635402, 4635403, 4639701, 4639702, 4686901, 4686902, 4687701, 4687702, 4687703, 1011201, 1011202, 1011203, 1011204, 1011205, 1012101, 1012102, 1012103, 1012104, 1013901, 1013902, 1020101, 1020102, 1031700, 1032501, 1032599, 1033301, 1033302, 1041400, 1042200, 1043100, 1051100, 1052000, 1053800, 1061901, 1061902, 1062700, 1063500, 1064300, 1065101, 1065102, 1065103, 1066000, 1069400, 1071600,  1072401, 1072402, 1081301, 1081302, 1082100, 1091101, 1091102, 1092900, 1093701, 1093702, 1094500, 1095300, 1096100, 1099601, 1099602, 1099603, 1099604, 1099605, 1099606, 1099607, 1099699, 4771701, 4771702, 8630501, 8630502, 8630503, 8650001, 9313100, 3092000, 4763603, 2330301, 2330303, 2330399, 2342702, 4731800, 3240099, 4711301, 4711302, 4713002, 4761003, 4763601, 3212400, 4649410, 4789001, 4711301, 4711302, 4771701, 3104700, 4754702, 4530701, 4541202, 4641901, 4641902, 4642701, 4642702, 4645101, 4647801, 4649403, 4649404, 4672900, 4673700, 4679699, 4689302, 5211701, 5211799, 2211100, 2330302, 2342702, 2710403, 2722801, 2732500, 2733300, 2751100, 2930103, 2941700, 2942500, 2943300, 2944100, 2949299, 3091102, 3092000, 3104700, 3240099, 3292202, 4530703, 4541202, 4541203, 4541206, 4711301, 4711302, 4712100, 4713002, 4742300, 4744001, 4744099, 4753900, 4754702, 4755501, 4755503, 4761003, 4763601, 4763603, 4771701, 4773300, 4781400, 2222600, 4921301, 4922101, 4922102, 4922103, 4923002, 4924800, 4929901, 4929902, 4929903, 4929904, 4930201, 4930202, 4930203, 4930204, 5211701, 2751100, 2759701, 2759799, 4711301, 4713004, 4753900., 3292202, 3292202, 2342702, 4679699, 4744099, 2732500, 2732500, 2740601, 2740602, 4672900, 4673700, 4679699, 4711301, 4711302, 4742300, 4744001, 4744099, 4645101, 4647801, 2710403, 3091102, 4541202, 4541203, 4541206, 2211100, 4621400, 4622200, 4623104, 4623105, 4623108, 4623109, 4631100, 4632001, 4632002, 4632003, 4633801, 4634601, 4634602, 4634603, 4634699, 4635401, 4635403, 4636201, 4637101, 4637102, 4637103, 4637104, 4637105, 4637106, 4637107, 4637199, 4639702, 4641901, 4641902, 4642701, 4642702, 4644301, 4644302, 4646001, 4673700, 4674500, 4681805, 4682600, 4683400, 4684201, 4684202, 4686901, 4686902, 1011201, 1011202, 1011203, 1011204, 1011205, 1012101, 1012102, 1012103, 1012104, 1013901, 1013902, 1020101, 1020102, 1031700, 1032501, 1032599, 1033301, 1033302, 1041400, 1042200, 1043100, 1051100, 1052000, 1053800, 1061901, 1061902, 1062700, 1063500, 1064300, 1065101, 1065102, 1065103, 1066000, 1069400, 1071600,  1072401, 1072402, 1082100, 1091101, 1091102, 1092900, 1093701, 1093702, 1094500, 1095300, 1096100, 1099601, 1099604, 1099605, 1099606, 1111901, 1111902, 1112700, 1113501, 1113502, 1121600, 1122401, 1122402, 1122403, 1122404, 1122499, 1321900, 1322700, 1323500, 1330800, 1351100, 1352900, 1353700, 1621800, 1721400, 1722200, 1922502, 2011800, 2013401, 2013402, 2029100, 2031200, 2032100, 2033900, 2040100, 2051700, 2052500, 2061400, 2062200, 2063100, 2071100, 2072000, 2073800, 2091600, 2110600, 2121101, 2121102, 2121103, 2122000, 2341900, 2342701, 2342702, 4711301, 4712100, 4713003, 4721102, 4721103, 4721104, 4722901, 4722902, 4732600, 4741500, 4742300, 4744099, 4755501, 4755502, 4755503, 4771701, 4772500, 4784900, 2722801, 2941700, 2943300, 2944100, 2949299, 4530701, 4530702, 4530703, 1311100, 1312000, 1313800, 1314600, 1321900, 1322700, 1323500, 1330800, 1340501, 1351100, 1352900, 1353700, 1354500, 1359600, 1411801, 1411802, 1412601, 1412603, 1413401, 1413403, 1414200, 1422300, 4641901, 4642701, 4642702, 4689302, 4711301, 4711302, 4755501, 4755503, 4781400, 2212900);
            '''

        cur.execute(sql)
        pg_conn.commit()

        insert_end = time.time()

        print_parcial_final_log_inf_retorno(f'Criação da tabela de estabelecimentos ativos e reduzida com cnaes de interesse do RFB na {base_dados}',
                                            insert_start,
                                            insert_end,
                                            '',
                                            'geral')

    except Exception as text:

        log_retorno_erro(text)


def tb_sql_estabele_baixados():
    """Função para criação da tabela estabelecimentos ativos no banco de dados postgres
    """

    try:

        # Conectar:
        cur, pg_conn = conecta_bd_generico(GetEnv('DB_NAME'))

        insert_start = time.time()
        extracted_files = GetEnv('EXTRACTED_FILES_PATH_CONVERT')
        base_dados = GetEnv('DB_NAME')

        # Dados arquivo/tabela (ESTABELECIMENTOS)
        # Criar tabela

        sql = '''
        CREATE TABLE tb_rfb_estabelecimento_reduzido_baixados AS
        SELECT
        tb_rfb_estabelecimentos.id_cod_cnpj_completo_num AS "CNPJ RFB",
        tb_rfb_estabelecimentos.data_inicio_atividade AS "DATA INICIO",
        tb_rfb_estabelecimentos.cod_cnae_fiscal_principal AS "COD CNAE PRINCIPAL",
        tb_ibge_municipios.id_cod_municipio_ibge AS "COD MUNÍCIPIO COMPLETO",
        tb_rfb_estabelecimentos.cod_situacao_cadastral AS "COD SITUAÇÃO CAD",
        tb_rfb_estabelecimentos.data_situacao_cadastral AS "DATA SITUAÇÃO CAD"
        FROM tb_rfb_estabelecimentos
        LEFT JOIN tb_rfb_municipios ON tb_rfb_estabelecimentos.id_cod_municipio_tom = tb_rfb_municipios.id_cod_municipio_tom_rfb
        LEFT JOIN tb_ibge_municipios ON tb_rfb_municipios.id_cod_municipio_tom_rfb = tb_ibge_municipios.id_cod_municipio_tom_rfb
        WHERE tb_rfb_estabelecimentos.id_cod_cnpj_completo_num NOT IN (87654547000199, 1650178000140, 8372222000147, 11160552000183, 12026980000180, 13624323000106, 31587659000110, 7323544000133, 10823533000127, 9386256000153, 10801453000170, 4784470000144, 91852087000180, 5290116000126, 92572668000121, 14244879000121, 31608589000139, 13152818000171, 12361704000179, 4834318000129, 17681193000196, 142402000120, 7033854000113, 1287024000136, 19192998000100, 26167903000155, 80738016000135, 18330394000101, 13393720000106, 10607264000161, 13348127000148, 5168429000106, 12755072000128, 12085614000100, 10954040000126, 17870582000160, 32022417000141, 17624843000161, 19858793000102, 26589865000129, 7092635000105, 6876768000100, 30745263000190, 2291846000153, 10724474000130, 18327497000112, 10324550000110, 11750929000154, 10417278000112, 37149378000161, 4606368000159, 90244328000146, 11011017000160, 91292987000110, 8764222000192, 14241179000183, 21521837000156, 5749407000130, 11319557000106, 5280807000149, 15773448000115, 5778763000181, 23733204000137, 6745734000186, 6279025000152, 87239448000140, 24722176000115, 77595395000147, 3387396000160, 23896394000103, 6112100000196, 41221516000143, 33031980000149, 9292819000144, 18648655000136, 18959545000195, 20290950000105, 14263090000118, 12868609000166, 10926916000120, 2405739000109, 30766484000145, 15987122000190, 1457287000146, 10965700000174, 5528196000105, 8075353000162, 77860435000130, 3258582000107, 1191673000139, 13766440000104, 25433214000182, 11739120000121, 57508426000178, 23096767000161, 1646378000120, 91182626000111, 29607095000198, 13676569000113, 1400923000101, 77603892000140, 35793784000137, 93403111000120, 8169258000128, 10556240000120, 5853843000154, 224288000188, 25086388000116, 72269012000127, 1682695000100, 28050012000140, 20239304000113, 78522554000146, 13163187000196, 20928455000189, 10264676000146, 26545701000108, 12067448000101, 2814497000107, 9134425000168, 11372084000100, 97211676000166, 12569628000191, 29708632000196, 4392005000168, 38311937000150, 11855966000127, 80478555000182, 27797063000177, 5928773000156, 10331291000154, 10319273000157, 14142262000103, 91138586000100, 97462816000179, 78724937000105, 25187828000121, 9196947000194, 1017449000125, 33081779000176, 21450633000171, 9090259000145, 13996470000107, 29881685000104, 2853780000148, 6209436000171, 9004287000100, 76989177000124, 63864771000147, 91864868000195, 22892910000169, 5032192000131, 26053424000108, 2579293000139, 7830558000143, 19334622000184, 10557159000165, 1674325000112, 12647362000158, 21399675000125, 9344389000167, 26086346000148, 9062965000183, 1185571000100, 4184646000127, 13704959000150, 18651461000190, 11121536000181, 6942101000168, 13240780000199, 9524449000123, 16920620000189, 8033521000157, 7870988000199, 86365350000177, 83011460000142, 18923585000187, 30411573000179, 7200203000170, 73856593000166, 14438471000190, 4590361000196, 3033301000100, 5067427000120, 32693095000162, 4955487000117, 3931194000137, 24544921000183, 7436513000199, 4415928000198, 2089969000106, 8311247000130, 3507744000195, 51023505000102, 13314645000140, 7606856000154, 10473269000149, 18856650000107, 4117484000104, 29404579000130, 4035721000198, 6077541000102, 2183774000120, 14856981000188, 9420215000136, 7580415000120, 2494891000105, 4439268000185, 9061689000139, 32402812000150, 79884201000159, 15984883000199, 90810706000101, 93090009000111, 17286461000175, 42985218000192, 25298910000123, 2030706000121, 6317393000148, 13584067000162, 24774433000162, 7443925000156, 13338682000199, 32864563000114, 4846902000102, 11152224000135, 7062098000150, 10518576000107, 81097503000129, 70097530000185, 7891015000136, 8375450000170, 11746084000123, 2399039000159, 6099712000196, 5672509000102, 11501334000165, 92730902000100, 30593462000120, 17778636000161, 12468400000105, 27723961000180, 73301814000130, 10655578000130, 18861682000192, 10653748000147, 4082624000156, 24250559000138, 20084744000149, 77845204000158, 94158912000130, 9262036000118, 717643000150, 10856350000108, 2501446000125, 89605505000193, 28215194000161, 13577156000181, 7938803000130, 83633552000164, 61916854000107, 17725726000194, 86577053000195, 36221828000117, 4521258000194, 14748505000143, 13569064000150, 4373539000147, 15862954000180, 13152186000146, 3737189000198, 20780212000146, 2876925000126, 32177092000176, 85778074000106, 16705150000130, 11137652000199, 32750620000134, 25245387000177, 12572403000194, 8335717000104, 19336810000141, 4775220000148, 2110010000105, 88094701000188, 60620366000195, 8776690000187, 91552687000123, 20353535000153, 3599608000172, 28664836000100, 6319500000177, 94672557000112, 75862961000104, 6021077000124, 23893289000110, 7301609000140, 65133423000125, 17454167000125, 73747164000150, 67331991000166, 30754413000122, 442060000164, 9070256000140, 2038025000100, 4075353000101, 21811317000188, 32876004000124, 37824745000185, 71507149000100, 9677256000102, 32237784000162, 1009078000130, 40756983000105, 5630747000147, 19178398000189, 22229447000170, 86421807000202, 4653148000186, 33931722000119, 7863671000125, 10319110000174, 7375625000187, 49914674000190, 7838419000166, 11460795000137, 82151382000119, 13197691000107, 21005582000179, 18688674000196, 7661744000104, 13002242000166, 33518975000165, 34742643000122, 14034002000106, 68917939000159, 5735623000126, 1496674000191, 43872274000183, 13104559000880, 5538848000192, 33817696000100, 10142144000136, 484213000136, 4758104000110, 80967193000193, 30774598000137, 641509000113, 11702090000189, 10293584000194, 952888000162, 9013998000133, 3912940000145, 7787570000112, 33771981000120, 793334000160, 23660930000177, 22873748000131, 20264474000158, 7661025000185, 10906818000121, 4961098000102, 4798150000143, 11918451000129, 34047293000184, 5194398000168, 27320369000138, 26136541000135, 24156274000132, 9639440000168, 1557107000106, 23334908000137, 31865753000193, 804102000160, 12937918000140, 15057636000147, 1759870000101, 354138000199, 11114322000188, 9305229000109, 21962126000117, 26404731000196, 73219024000100, 14958619000118, 2400983000189, 11098320000142, 5853586000150, 54514294000107, 34565836000155, 17475120000148, 8844658000191, 4655002000170, 36807782000112, 22882054000160, 3304122000160, 93255560000178, 21261633000123, 84558246000173, 10510260000160, 5540826000167, 14053405000100, 4083740000190, 3064064000144, 7632090000182, 12772041000185, 90522616000115, 24593984000120, 4169552000189, 27582444000139, 7249792000181, 14906006000137, 3344114000147, 2838996000134, 9544299000110, 14988166000172, 8596031000169, 6860056000100, 49150352001780, 11015268000113, 3241729000148, 3949277000153, 7124537000102, 3052955000180, 27053643000150, 3815704000100, 4032698000188, 1718007000106, 1518918000190, 40881070000110, 31776980000142, 4779723000191, 22709109000488, 10429912000137, 5800922000105, 74766452000115, 7415457000106, 26308783000169, 17582811000140, 1518792000153, 3580670000112, 11572365000107, 7293074000102, 10488640000146, 9603433000106, 2137011000143, 85779049000147, 20501045000157, 15352689000190, 11058004000147, 8316250000147, 19221529000163, 6894902000103, 10201332000198, 4242295000163, 3485572000104, 4183037000153, 72671985000198, 24580379000114, 846087000112, 8818635000102, 25113317000165, 12988833000191, 20637022000174, 35416995000150, 3060101000146, 28035917000140, 28608910000170, 9044133000134, 2028121000177, 4295678000108, 18555317000150, 26349902000121, 2320214000170, 4013782000154, 2693879000120, 19391098000183, 10417944000112, 3315118000105, 3123142000134, 10955404000192, 90609108000179, 7739675000104, 24436602000154, 35223590000104, 9306435000133, 4305323000144, 73112021000172, 2731568000108, 773500000166, 70357959000164, 2314123000122, 33904216000130, 7041711000153, 13616671000123, 19376115000103, 5262669000175, 88766639000123, 4853451000122, 14379618000119, 9326382000112, 89908727000185, 1134900000194, 23957787000180, 28109100000170, 16492097000137, 5662237000151, 13479150000171, 29801202000114, 8149575000182, 24744354000109, 9622693000129, 8939220000197, 12266152000110, 82284894000153, 12181806000102, 2578849000172, 27717999000140, 7335692000178, 15251430000153, 19762269000133, 87843033000181, 6276610000107, 13428316000120, 25804147000165, 5935542000170, 92314079000143, 11186727000121, 5291198000123, 18334203000180, 35093301000191, 22221083000181, 75216523000179, 7459218000158, 36394573000194, 39815253000159, 9424036000177, 8388070000170, 84718741000100, 26069514000197, 19867464000128, 85285963000131, 30967492000150, 17741764000130, 28578840000155, 90740754000170, 35725815000112, 11404442000110, 29558488000159, 25376211000154, 12998267000107, 8687308000169, 3601579000136, 26953545000106, 31588721000198, 27127366000182, 20781169000133, 83567131000182, 6255024000178, 8806091000169, 12367204000144, 52476850000164, 8990717000130, 15629579000123, 13612189000115, 24772424000132, 196198000120, 7144671000175, 31341267000176, 37413861000101, 7682079000127, 85494680000108, 9171688000147, 83535252000142, 37813005000143, 73909566000104, 16863858000110, 1253958000157, 75267096000158, 31367633000166, 2297711000103, 80896806000149, 3650831000105, 83814814000197, 25994179000170, 10629153000156, 7684186000194, 12726300000131, 94123924000129, 2686151000170, 1742668000177, 9641131000122, 1488023000150, 25056200000197, 9174668000120, 21719299000109, 236671000156, 1703234000168, 7073022000120, 4535308000192, 4371905000129, 2014786000121, 21521925000158, 4749121000191, 84640580000171, 234266000107, 31874640000154, 18157929000194, 9050399000190, 1389000190, 18400766000129, 16625131000102, 87568200000123, 5763785000178, 11021978000156, 5316470000182, 4940257000184, 9068809000120, 91358788000168, 19051962000106, 3224567000130, 2472170000102, 9497934000155, 82096413000186, 10546807000188, 97094213000161, 31685489000106, 6862627000138, 361145000118, 5680854000180, 71320915000122, 7305810000103, 4751143000196, 2899356000134, 3156454000144, 79671236000100, 7978664000179, 26629673000107, 5584693000120, 93915817000170, 22820121000112, 10394709000172, 25964297000136, 28206623000134, 17284472000116, 6031432000146, 20647083000112, 22720429000196, 32296378000170, 20487400000180, 2440124000202, 33873562000107, 8527137000100, 26469075000100, 20929806000176, 14586770000172, 20319862000199, 6944437000160, 4699734000161, 7278138000104, 9346890000162, 4742371000108, 21130401000136, 27665301000190, 4986601000176, 14339371000107, 820570000128, 23320828000122, 26324835000190, 18017986000178, 23446628000110, 93037000101, 5842683000148, 8995091000154, 8046521000191, 9029474000130, 35315298000103, 86764511000103, 10873405000198, 7435640000173, 23792228000167, 80755135000104, 72026024000120, 17907975000109, 27422098000121, 14986335000135, 22605881000107, 75864728000160, 5169277000166, 8328971000177, 9626955000123, 9583268000178, 50461862000190, 10156597000111, 24272120000106, 4007969000145, 108947000110, 2272397000104, 11228680000111, 6942954000108, 10334488000147, 17337357000162, 1089636000114, 3128888000130, 10353532000166, 947030000100, 15993215000128, 5194005000116, 17178947000190, 12359092000180, 33130762000161, 2492310000104, 5466497000151, 8246247000102, 16857013000111, 15866494000169, 22277750000148, 7005073000115, 3995725000155, 16948086000119, 9142445000180, 19851584000137, 9245965000119, 24138177000117, 27074467000132, 23197841000136, 15393287000134, 14790204000188, 77371789000111, 20841144000188, 11804459000164, 25179227000177, 7428727000113, 17569551000173, 12991318000160, 7705871000150, 9296387000140, 86697794000100, 18717889000198, 5505984000186, 82024548000136, 2612937000143, 10315503000100, 11734333000160, 33310392000144, 5753695000104, 31666870000128, 5505281000158, 10342077000101, 59225268000174, 20258849000177, 9083970000172, 7105803000150, 2689608000109, 569638000148, 1667041000107, 8031846000109, 11234956000174, 30444064000142, 14247873000108, 81866592000120, 7621282000193, 11001080000116, 3659621000170, 18552925000100, 36127970000108, 32986909000157, 93899359000123, 80213705000126, 19046218000105, 30081600000192, 89943849000102, 23615570000191, 1766275000101, 30755223000120, 75130245000132, 37929615000107, 94675295000140, 93445963000180, 90295338000100, 33689469000139, 13891071000173, 7248875000156, 3531879000196, 7322489000167, 89305197000180, 22456927000173, 8354288000104, 4141900000100, 22280670000141, 9110878000154, 12133320000107, 22354902000169, 55643555000143, 27153586000180, 12001402000190, 13249713000135, 20005140000160, 2276470000108, 4910063000136, 67673087000139, 19540628000108, 23176936000173, 22251565000184, 1211210000191, 17191016000121, 2284641000140, 41697285000149, 94931912000120, 3958603000199, 5467743000190, 8072308000154, 6916962000171, 7576815000162, 8282001000188, 32981557000147, 11045451000161, 2322372000160, 4190025000156, 8166114000118, 7537580000108, 8457522000129, 13054076000141, 2851400000136, 5862382000186, 37657084000140, 13269933000120, 12506396000122, 28254772000179, 37527173000172, 4770484000109, 1771322000105, 11783783000143, 33326931000133, 97225346000120, 11363988000170, 74631011000106, 19827805000131, 3735190000183, 286675000149, 28430762000147, 11450748000102, 6628333000146, 52985272000191, 7001950000180, 5902762000105, 26383059000108, 10593247000112, 95600235000120, 29467341000153, 25158815000124, 49475833000106, 5797607000168, 1733416000181, 3877185000105, 91704882000121, 10226694000133, 8395782000389, 8742386000119, 969518000138, 20321038000173, 70160569000108, 51609238000150, 18107045000125, 3540368000130, 90954892000152, 25071206000214, 6182834000141, 10377432000170, 13414093000142, 11582787000163, 6348590000124, 62098587000170, 2595626000113, 19445733000168, 2591772000170, 84552827000106, 23339549000100, 10857495000123, 32234596000180, 12876296000198, 7030782000150, 9286416000192, 11485623000118, 5215132000154, 22354870000100, 11101919000198, 8538303000174, 85179687000127, 29938282000154, 15570971000144, 4234108000108, 32770509000100, 23119027000101, 32118250000117, 79731642000110, 26608359000130, 82784216000150, 35280632000130, 4711205000136, 6890010000126, 7789728000193, 7931395000195, 28569816000150, 13089515000151, 7629404000198, 2736688000106, 24462610000175, 4498933000101, 10905062000104, 31882359000163, 11504209000109, 81035388000168, 21946485000180, 30563332000145, 16515058000108, 4535267000134, 8972622000193, 623492000171, 31187412000106, 3392558000158, 2264742000150, 85075141000126, 34943991000168, 97385876000135, 2267742000103, 21265282000129, 14514225000170, 10864443000184, 7416694000191, 8246978000140, 15116538000133, 2019387000153, 9517479000102, 4427124000109, 77817674000108, 25275663000140, 18458237000186, 5654524000110, 7930496000141, 8090078000156, 7224562000168, 15370406000133, 11575452000118, 33281991000187, 10367327000150, 21894569000118, 17384587000182, 33078767000192, 3080418000144, 89631998000136, 14713212000120, 14207493000140, 35411767000198, 8474088000195, 11983847000150, 7649230000125, 4697865000100, 82120460000118, 10439285000115, 71235295000123, 2866734000183, 41687484000257, 78742384000105, 5790491000135, 3410797000193, 8296762000199, 7409655000167, 27419009000198, 56761570000159, 12940209000114, 4477018000130, 2407579000137, 16026841000108, 84600378000116, 2924249000119, 1164075000170, 62098587000413, 34969576000183, 10856709000147, 42237412000190, 12726493000120, 5939266000118, 11477713000167, 958548000149, 7028514000102, 12826187000166, 20469578000107, 11143950000191, 27806368000106, 13240799000135, 30080460000138, 5437370000104, 28111682000129, 13961509000142, 10349258000151, 1682147000171, 10770797000160, 11316220000145, 19668909000140, 22020994000140, 911696000108, 34195547000101, 24977964000152, 10364691000166, 28580702000100, 16111833000160, 76865377000175, 11105698000126, 15823601000171, 130790000120, 65963142000108, 29567699000158, 8299152000149, 10905163000177, 11944052000132, 30719860000140, 6353241000109, 12354843000175, 3927995000129, 35284991000166, 20294734000138, 7010513000122, 3717227000140, 19297637000110, 616839000159, 80812092000143, 15583552000147, 7228698000146, 29353919000140, 26547362000190, 8533503000134, 32613134000174, 4234637000101, 12721248000120, 13271091000141, 30725265000118, 4228626000100, 72067523000166, 29607886000118, 66432501000155, 8696758000118, 17200017000195, 8038502000113, 4612254000111, 9174668000200, 30222814000131, 94938750000152, 16502667000122, 62404264000168, 11739586000127, 24883359000112, 14072177000108, 5134355000197, 4441266000120, 13057809000100, 11160749000112, 9361956000193, 41448556000122, 92215763000178, 11949701000198, 17194994000127, 5624386000126, 704968000107, 28862709000115, 13481491000181, 23736320000100, 8174282000155, 10815830000120, 2436957000100, 349823000127, 2297980000161, 9482747000106, 4828338000197, 6132707000138, 35496123000140, 37791609000136, 16801508000129, 7984506000121, 1106257000195, 33722608000189, 91749366000113, 22579338000182, 7346923000149, 9220797000107, 72370364000174, 30120557000127, 9544291000153, 8802842000179, 9686521000119, 46680708000131, 636743000152, 32679738000113, 7445385000140, 17179801000169, 62461140000114, 4220766000132, 3902129000183, 10870662000176, 19570720000110, 7866845000103, 7150233000110, 8427008000140, 7342052000195, 1302294000179, 50154061000181, 30941898000163, 11009721000189, 18824765000101, 5959479000101, 20483788000141, 11623188000140, 69418101000183, 98513187000121, 14056371000108, 8469844000198, 28321736000180, 20405316000170, 7059955000163, 24206617000126, 15489834000180, 5108821000160, 17420521000109, 4056752000125, 16626814000176, 4442991000113, 1149282000156, 10947853000199, 32972408000111, 7667939000153, 23422758000113, 6010434000159, 5452972000130, 10193089000103, 19169675000197, 94560620000129, 2234943000104, 1196411000167, 34946519000189, 911664000102, 20507442000136, 2654132000162, 3768328000140, 38154506000128, 17431120000146, 34903896000130, 97168066000127, 43015734000157, 13042032000100, 8901198000196, 19420416000197, 15287467000131, 71131296000128, 7307836000182, 7350344000170, 3946428000110, 21823191000161, 44938694000188, 3832894000174, 27966400000102, 4018242000163, 7883178000177, 2156401000160, 37323959000178, 9483354000109, 43248863000195, 43667922000160 
        ) AND cod_situacao_cadastral IN (8)
        AND  data_situacao_cadastral >= '2012-01-01'
        AND
        tb_rfb_estabelecimentos.cod_cnae_fiscal_principal IN (2121101, 2121102, 2121103, 2122000, 3211602, 4741500, 4771701, 4771702, 4783101, 5120000, 5611201, 9601701, 1091101, 4711301, 4711302, 4712100, 4721102, 4721103, 4721104, 4722901, 4722902, 4724500, 4771704, 4789004, 7500100, 9609207, 9609208, 4621400, 4623101, 4623102, 4623103, 4623104, 4623105, 4623106, 4623107, 4623108, 4623109, 4632001, 4632002, 4632003, 4633801, 4633802, 4633803, 4634601, 4634602, 4634603, 4635401, 4635402, 4635403, 4639701, 4639702, 4686901, 4686902, 4687701, 4687702, 4687703, 1011201, 1011202, 1011203, 1011204, 1011205, 1012101, 1012102, 1012103, 1012104, 1013901, 1013902, 1020101, 1020102, 1031700, 1032501, 1032599, 1033301, 1033302, 1041400, 1042200, 1043100, 1051100, 1052000, 1053800, 1061901, 1061902, 1062700, 1063500, 1064300, 1065101, 1065102, 1065103, 1066000, 1069400, 1071600,  1072401, 1072402, 1081301, 1081302, 1082100, 1091101, 1091102, 1092900, 1093701, 1093702, 1094500, 1095300, 1096100, 1099601, 1099602, 1099603, 1099604, 1099605, 1099606, 1099607, 1099699, 4771701, 4771702, 8630501, 8630502, 8630503, 8650001, 9313100, 3092000, 4763603, 2330301, 2330303, 2330399, 2342702, 4731800, 3240099, 4711301, 4711302, 4713002, 4761003, 4763601, 3212400, 4649410, 4789001, 4711301, 4711302, 4771701, 3104700, 4754702, 4530701, 4541202, 4641901, 4641902, 4642701, 4642702, 4645101, 4647801, 4649403, 4649404, 4672900, 4673700, 4679699, 4689302, 5211701, 5211799, 2211100, 2330302, 2342702, 2710403, 2722801, 2732500, 2733300, 2751100, 2930103, 2941700, 2942500, 2943300, 2944100, 2949299, 3091102, 3092000, 3104700, 3240099, 3292202, 4530703, 4541202, 4541203, 4541206, 4711301, 4711302, 4712100, 4713002, 4742300, 4744001, 4744099, 4753900, 4754702, 4755501, 4755503, 4761003, 4763601, 4763603, 4771701, 4773300, 4781400, 2222600, 4921301, 4922101, 4922102, 4922103, 4923002, 4924800, 4929901, 4929902, 4929903, 4929904, 4930201, 4930202, 4930203, 4930204, 5211701, 2751100, 2759701, 2759799, 4711301, 4713004, 4753900., 3292202, 3292202, 2342702, 4679699, 4744099, 2732500, 2732500, 2740601, 2740602, 4672900, 4673700, 4679699, 4711301, 4711302, 4742300, 4744001, 4744099, 4645101, 4647801, 2710403, 3091102, 4541202, 4541203, 4541206, 2211100, 4621400, 4622200, 4623104, 4623105, 4623108, 4623109, 4631100, 4632001, 4632002, 4632003, 4633801, 4634601, 4634602, 4634603, 4634699, 4635401, 4635403, 4636201, 4637101, 4637102, 4637103, 4637104, 4637105, 4637106, 4637107, 4637199, 4639702, 4641901, 4641902, 4642701, 4642702, 4644301, 4644302, 4646001, 4673700, 4674500, 4681805, 4682600, 4683400, 4684201, 4684202, 4686901, 4686902, 1011201, 1011202, 1011203, 1011204, 1011205, 1012101, 1012102, 1012103, 1012104, 1013901, 1013902, 1020101, 1020102, 1031700, 1032501, 1032599, 1033301, 1033302, 1041400, 1042200, 1043100, 1051100, 1052000, 1053800, 1061901, 1061902, 1062700, 1063500, 1064300, 1065101, 1065102, 1065103, 1066000, 1069400, 1071600,  1072401, 1072402, 1082100, 1091101, 1091102, 1092900, 1093701, 1093702, 1094500, 1095300, 1096100, 1099601, 1099604, 1099605, 1099606, 1111901, 1111902, 1112700, 1113501, 1113502, 1121600, 1122401, 1122402, 1122403, 1122404, 1122499, 1321900, 1322700, 1323500, 1330800, 1351100, 1352900, 1353700, 1621800, 1721400, 1722200, 1922502, 2011800, 2013401, 2013402, 2029100, 2031200, 2032100, 2033900, 2040100, 2051700, 2052500, 2061400, 2062200, 2063100, 2071100, 2072000, 2073800, 2091600, 2110600, 2121101, 2121102, 2121103, 2122000, 2341900, 2342701, 2342702, 4711301, 4712100, 4713003, 4721102, 4721103, 4721104, 4722901, 4722902, 4732600, 4741500, 4742300, 4744099, 4755501, 4755502, 4755503, 4771701, 4772500, 4784900, 2722801, 2941700, 2943300, 2944100, 2949299, 4530701, 4530702, 4530703, 1311100, 1312000, 1313800, 1314600, 1321900, 1322700, 1323500, 1330800, 1340501, 1351100, 1352900, 1353700, 1354500, 1359600, 1411801, 1411802, 1412601, 1412603, 1413401, 1413403, 1414200, 1422300, 4641901, 4642701, 4642702, 4689302, 4711301, 4711302, 4755501, 4755503, 4781400, 2212900);
        '''

        cur.execute(sql)
        pg_conn.commit()

        insert_end = time.time()

        print_parcial_final_log_inf_retorno(f'Criação da tabela de estabelecimentos baixados depois de 2012-01-01 e reduzida com cnaes de interesse do RFB na {base_dados}',
                                            insert_start,
                                            insert_end,
                                            '',
                                            'geral')

    except Exception as text:

        log_retorno_erro(text)


def sequencia_tabelas_RFB():

    try:

        insert_start = time.time()
        base_dados = GetEnv('DB_NAME')

        '''funçao_barprogress([inserir_dados_estab_bd,
                            cnpj_repetidos_rfb,
                            dados_faltantes_rfb,
                            criar_indices_rfb],
                           'blue')'''

        funçao_barprogress([tb_sql_estabele_ativos],
                           'blue')

        insert_end = time.time()

        print_parcial_final_log_inf_retorno(f'Criação da tabela da RFB na {base_dados}',
                                            insert_start,
                                            insert_end,
                                            '',
                                            'geral')

    except Exception as text:

        log_retorno_erro(text)


sequencia_tabelas_RFB()
